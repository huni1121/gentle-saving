<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æº«æŸ”å­˜éŒ¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF50">
<link rel="icon" href="icon-192.png">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f6f7f8;
  margin: 0;
  padding: 20px;
  color: #333;
}
.card {
  background: #fff;
  border-radius: 16px;
  padding: 22px;
  max-width: 420px;
  margin: auto;
  box-shadow: 0 6px 16px rgba(0,0,0,.08);
}
h1 {
  text-align: center;
  font-size: 22px;
}
.hint {
  text-align: center;
  font-size: 14px;
  color: #777;
}
.amount {
  font-size: 42px;
  text-align: center;
  margin: 20px 0;
  font-weight: bold;
}
.character {
  text-align: center;
  margin: 16px 0;
}
.character img {
  width: 120px;
  margin: 0 6px;
}
.message {
  text-align: center;
  font-size: 14px;
  color: #555;
  margin-top: 8px;
}
button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
}
.save {
  background: #4CAF50;
  color: #fff;
}
.rest {
  margin-top: 10px;
  background: #bbb;
}
.total {
  text-align: center;
  margin-top: 16px;
  font-weight: bold;
}
ul {
  list-style: none;
  padding: 0;
  margin-top: 18px;
  max-height: 240px;
  overflow-y: auto;
  font-size: 14px;
}
li {
  padding: 8px 0;
  border-bottom: 1px solid #eee;
}
.reset {
  margin-top: 16px;
  background: #f44336;
  color: #fff;
}
</style>
</head>

<body>
<div class="card">

<div id="topArea"></div>

<h1>ğŸŒ± æº«æŸ”å­˜éŒ¢</h1>
<div class="hint">ä»Šå¤©èƒ½çµ¦å¤šå°‘éƒ½å¥½ï¼Œä¼‘æ¯ä¹Ÿæ²’é—œä¿‚</div>

<div class="amount" id="todayAmount">â€”</div>

<button class="save" id="saveBtn">ä»Šå¤©å­˜é€™å€‹é‡‘é¡</button>
<button class="rest" id="restBtn">ä»Šå¤©ä¼‘æ¯ä¹Ÿå¯ä»¥</button>

<div class="total" id="totalAmount">ç´¯ç©é‡‘é¡ï¼š0 å…ƒ</div>

<ul id="recordList"></ul>

<div id="bottomArea"></div>

<button class="reset" onclick="resetData()">é‡æ–°é–‹å§‹</button>
</div>

<script>
const messages = [
  "ä»Šå¤©é¡˜æ„ç‚ºè‡ªå·±åœä¸€ä¸‹ï¼Œå·²ç¶“å¾ˆä¸å®¹æ˜“äº†ã€‚",
  "æ…¢æ…¢ä¾†å°±å¥½ï¼Œæˆ‘å€‘åœ¨ä½ èº«é‚Šã€‚",
  "ä½ æ­£åœ¨ç”¨è‡ªå·±çš„ç¯€å¥å‰é€²ã€‚",
  "å°±ç®—ä»€éº¼éƒ½ä¸åšï¼Œä¹Ÿä¸ä»£è¡¨ä½ ä¸å¤ å¥½ã€‚",
  "ä½ ä¸éœ€è¦è­‰æ˜ä»»ä½•äº‹ã€‚"
];

const characterHTML = `
  <div class="character">
    <img src="fox.png">
    <img src="sheep.png">
    <div class="message">${messages[Math.floor(Math.random()*messages.length)]}</div>
  </div>
`;

(Math.random() > 0.5 
  ? document.getElementById("topArea") 
  : document.getElementById("bottomArea")
).innerHTML = characterHTML;

// ===== å­˜éŒ¢åŸæœ¬é‚è¼¯ =====
const today = new Date().toISOString().split("T")[0];
const todayAmountEl = document.getElementById("todayAmount");
const saveBtn = document.getElementById("saveBtn");
const restBtn = document.getElementById("restBtn");
const totalAmountEl = document.getElementById("totalAmount");
const recordList = document.getElementById("recordList");

let records = JSON.parse(localStorage.getItem("gentleSavingRecords")) || [];

function generateRandomAmount() {
  return Math.floor(Math.random() * 356) + 10;
}

function getTodayRecord() {
  return records.find(r => r.date === today);
}

function render() {
  const todayRecord = getTodayRecord();

  if (todayRecord) {
    todayAmountEl.textContent = todayRecord.amount + " å…ƒ";
    saveBtn.disabled = true;
    restBtn.disabled = true;
  } else {
    todayAmountEl.textContent = generateRandomAmount() + " å…ƒ";
    saveBtn.disabled = false;
    restBtn.disabled = false;
  }

  const total = records.reduce((sum, r) => sum + r.amount, 0);
  totalAmountEl.textContent = "ç´¯ç©é‡‘é¡ï¼š" + total + " å…ƒ";

  recordList.innerHTML = "";
  records.slice().reverse().forEach(r => {
    const li = document.createElement("li");
    li.textContent = `${r.date}ï½œ${r.amount} å…ƒ`;
    recordList.appendChild(li);
  });
}

saveBtn.onclick = () => {
  records.push({ date: today, amount: parseInt(todayAmountEl.textContent) });
  localStorage.setItem("gentleSavingRecords", JSON.stringify(records));
  render();
};

restBtn.onclick = () => {
  alert("ä»Šå¤©é¸æ“‡ä¼‘æ¯ï¼Œä¹Ÿæ˜¯ä¸€ç¨®ç…§é¡§ ğŸ¤");
  saveBtn.disabled = true;
  restBtn.disabled = true;
};

function resetData() {
  if (confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿ")) {
    localStorage.removeItem("gentleSavingRecords");
    records = [];
    render();
  }
}

render();

// PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}
</script>
</body>
</html>